pipeline {
    agent any
    tools {
        maven 'M3'
    }
    stages {
        //stage('scm'){
        //    steps{
        //        git branch: 'master',
        //        credentialsId: 'GitHub username and mdp',
        //        url: 'https://github.com/JeezLF/ITIIP15-DevOps-MurlopsTeam.git'
        //    }
        //}
        stage('Build') {
            steps {
               dir("retwisj"){
                       sh 'mvn -Dmaven.test.failure.ignore clean package'
               }
            }
        }
         stage('Docker') {
            steps {
		script {
			docker.withRegistry( '', 'DockerHub' ) {
			
                   sh '/usr/bin/docker build -t retwisj:latest .'
                   sh 'docker tag retwisj:latest luca83000/retwisj:latest'
                   sh 'docker push luca83000/retwisj:latest' }
			}
            }
        }
	stage('Test') {
		steps {
			sh 'touch retwisj/target/surefire-reports/TEST-.xml'
			junit 'retwisj/target/surefire-reports/TEST-.xml'
			}
        }
    }
}