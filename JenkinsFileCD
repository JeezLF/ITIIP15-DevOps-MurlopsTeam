pipeline {
    agent any
    tools {
        maven 'M3'
    }
    stages {
		stage('K8S') {
			steps {
				sh 'gcloud auth activate-service-account credentialsId: 'pipelinecd''
				sh 'gcloud container clusters get-credentials murlops-cluster1 --zone europe-west1-b --project murlops'
			}
		}
		stage('yaml') {
			steps {
				sh 'pwd'
				sh 'ls -la'
				sh 'cat deploy.yaml'
				sh 'cat ../pipelineci/deploy.yaml'	
				sh 'kubectl apply -f ../pipelineci/deploy.yaml'
			}
		} 

		stage('Scan with Probely') {
      		steps {
        		probelyScan targetId: '2Yf589vvQXop', credentialsId: 'Probely'
      			}
    }		
    }
}